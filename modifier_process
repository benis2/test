<?php
date_default_timezone_set('Africa/Abidjan');
error_reporting(E_ALL);
ini_set('display_errors', '1');

// Connexion à la base de données
$servername = "localhost";
$username = "root";
$password = "";
$dbname = "mission";

// Création de la connexion
$conn = new mysqli($servername, $username, $password, $dbname);

// Vérification de la connexion
if ($conn->connect_error) {
    die("Connexion échouée : " . $conn->connect_error);
}

// Vérifier l'existence des clés d'index avant de les utiliser
$id = isset($row['id']) ? $row['id'] : null;


// Vérifier si le formulaire a été soumis
if (isset($_POST['submit'])) {
    // Récupérer les valeurs des champs du formulaire
    // $id = $_POST['id'];
    $numero_equipe = $_POST['numero_equipe'];
    $SECTION = $_POST['SECTION'];
    $INTITULE_PROJET = $_POST['INTITULE_PROJET'];
    $CODE_ACTIVITE_BUDGETAIRE = $_POST['CODE_ACTIVITE_BUDGETAIRE'];
    $OBJECTIF_SPECIFIQUE_PROJET = $_POST['OBJECTIF_SPECIFIQUE_PROJET'];
    $DATE_DEMARRAGE = $_POST['DATE_DEMARRAGE'];
    $DATE_FIN_PREVISIONNELLE = $_POST['DATE_FIN_PREVISIONNELLE'];
    $MILIEU_EXECUTION = $_POST['MILIEU_EXECUTION'];
    $district = $_POST['district'];
    $region = $_POST['region'];
    $departement = $_POST['departement'];
    $sous_prefecture = $_POST['sous_prefecture'];
    $localite = $_POST['localite'];
    $TYPE_PROJET = $_POST['TYPE_PROJET'];
    $latitude = $_POST['latitude'];
    $longitude = $_POST['longitude'];
    $COUT_INITIAL_PROJET = $_POST['COUT_INITIAL_PROJET'];
    $COUT_ACTUEL_PROJET = $_POST['COUT_ACTUEL_PROJET'];
    $SOURCE_FINANCEMENT = $_POST['SOURCE_FINANCEMENT'];
    $TYPE_FINANCEMENT = $_POST['TYPE_FINANCEMENT'];
    $COMPOSANTE = $_POST['COMPOSANTE'];
    $COUT_COMPOSANTE = $_POST['COUT_COMPOSANTE'];
    $No_MARCHE = $_POST['No_MARCHE'];
    $OBJET_DU_MARCHE = $_POST['OBJET_DU_MARCHE'];
    $COUT_INITIAL_MARCHE = $_POST['COUT_INITIAL_MARCHE'];
    $COUT_ACTUEL_MARCH = $_POST['COUT_ACTUEL_MARCH'];
    $LIVRABLES_ATTENDUS = $_POST['LIVRABLES_ATTENDUS'];
    $LIVRABLES_DEJA_DELIVRES = $_POST['LIVRABLES_DEJA_DELIVRES'];
    $COUT_LIVRABLES_ATTENDUS = $_POST['COUT_LIVRABLES_ATTENDUS'];
    $LIVRABLES_RESTANT_A_DELIVRER = $_POST['LIVRABLES_RESTANT_A_DELIVRER'];
    $COMPOSANTE2 = $_POST['COMPOSANTE2'];
    $COUT_COMPOSANTE2 = $_POST['COUT_COMPOSANTE2'];
    $No_MARCHE2 = $_POST['No_MARCHE2'];
    $OBJET_DU_MARCHE2 = $_POST['OBJET_DU_MARCHE2'];
    $COUT_INITIAL_MARCHE2 = $_POST['COUT_INITIAL_MARCHE2'];
    $COUT_ACTUEL_MARCH2 = $_POST['COUT_ACTUEL_MARCH2'];
    $LIVRABLES_ATTENDUS2 = $_POST['LIVRABLES_ATTENDUS2'];
    $LIVRABLES_DEJA_DELIVRES2 = $_POST['LIVRABLES_DEJA_DELIVRES2'];
    $COUT_LIVRABLES_ATTENDUS2 = $_POST['COUT_LIVRABLES_ATTENDUS2'];
    $LIVRABLES_RESTANT_A_DELIVRER2 = $_POST['LIVRABLES_RESTANT_A_DELIVRER2'];
    $BENEFICIAIRES_PREVISIONNELS = $_POST['BENEFICIAIRES_PREVISIONNELS'];
    $ETAT_ACTUEL_LIVRABLE = $_POST['ETAT_ACTUEL_LIVRABLE'];
    $TAUX_EXECUTION_PHYSIQUE = $_POST['TAUX_EXECUTION_PHYSIQUE'];
    $TAUX_EXECUTION_FINANCIERE = $_POST['TAUX_EXECUTION_FINANCIERE'];
    $RESTE_A_EXECUTER = $_POST['RESTE_A_EXECUTER'];
    $NIVEAU_SATISFACTION_BENEFICIAIRES = $_POST['NIVEAU_SATISFACTION_BENEFICIAIRES'];
    $NOM_CF = $_POST['NOM_CF'];
    $CONTACT_CF = $_POST['CONTACT_CF'];
    $NOM_COORDONNATEUR = $_POST['NOM_COORDONNATEUR'];
    $CONTACT_COORD = $_POST['CONTACT_COORD'];
    $observation = $_POST['observation'];
    $COUT_LIVRABLES_DEJA_DELIVRES = $_POST['COUT_LIVRABLES_DEJA_DELIVRES'];
    $COUT_LIVRABLES_DEJA_DELIVRES2 = $_POST['COUT_LIVRABLES_DEJA_DELIVRES2'];


    // Requête pour mettre à jour les données du projet


 $updateSql = "UPDATE mission SET 
numero_equipe = '$numero_equipe',
SECTION = '$SECTION',
INTITULE_PROJET = '$INTITULE_PROJET',
CODE_ACTIVITE_BUDGETAIRE = '$CODE_ACTIVITE_BUDGETAIRE',
INTITULE_PROJET = '$INTITULE_PROJET',
OBJECTIF_SPECIFIQUE_PROJET = '$OBJECTIF_SPECIFIQUE_PROJET',
DATE_DEMARRAGE = '$DATE_DEMARRAGE',
DATE_FIN_PREVISIONNELLE = '$DATE_FIN_PREVISIONNELLE',
MILIEU_EXECUTION = '$MILIEU_EXECUTION',
district = '$district',
region = '$region',
departement = '$departement',
sous_prefecture = '$sous_prefecture',
localite = '$localite',
TYPE_PROJET = '$TYPE_PROJET',
latitude = '$latitude',
longitude = '$longitude',
COUT_INITIAL_PROJET = '$COUT_INITIAL_PROJET',
COUT_ACTUEL_PROJET = '$COUT_ACTUEL_PROJET',
SOURCE_FINANCEMENT = '$SOURCE_FINANCEMENT',
TYPE_FINANCEMENT = '$TYPE_FINANCEMENT',
COMPOSANTE = '$COMPOSANTE',
COUT_COMPOSANTE = '$COUT_COMPOSANTE',
No_MARCHE = '$No_MARCHE',
OBJET_DU_MARCHE = '$OBJET_DU_MARCHE',
COUT_INITIAL_MARCHE = '$COUT_INITIAL_MARCHE',
COUT_ACTUEL_MARCH = '$COUT_ACTUEL_MARCH',
LIVRABLES_ATTENDUS = '$LIVRABLES_ATTENDUS',
LIVRABLES_DEJA_DELIVRES = '$LIVRABLES_DEJA_DELIVRES',
COUT_LIVRABLES_ATTENDUS = '$COUT_LIVRABLES_ATTENDUS',
LIVRABLES_DEJA_DELIVRES = '$LIVRABLES_DEJA_DELIVRES',
COUT_LIVRABLES_DEJA_DELIVRES = '$COUT_LIVRABLES_DEJA_DELIVRES',
LIVRABLES_RESTANT_A_DELIVRER = '$LIVRABLES_RESTANT_A_DELIVRER',
COMPOSANTE2 = '$COMPOSANTE2',
COUT_COMPOSANTE2 = '$COUT_COMPOSANTE2',
No_MARCHE2 = '$No_MARCHE2',
OBJET_DU_MARCHE2 = '$OBJET_DU_MARCHE2',
COUT_INITIAL_MARCHE2 = '$COUT_INITIAL_MARCHE2',
COUT_ACTUEL_MARCH2 = '$COUT_ACTUEL_MARCH2',
LIVRABLES_ATTENDUS2 = '$LIVRABLES_ATTENDUS2',
LIVRABLES_DEJA_DELIVRES2 = '$LIVRABLES_DEJA_DELIVRES2',
COUT_LIVRABLES_ATTENDUS2 = '$COUT_LIVRABLES_ATTENDUS2',
LIVRABLES_DEJA_DELIVRES2 = '$LIVRABLES_DEJA_DELIVRES2',
COUT_LIVRABLES_DEJA_DELIVRES2 = '$COUT_LIVRABLES_DEJA_DELIVRES2',
LIVRABLES_RESTANT_A_DELIVRER2 = '$LIVRABLES_RESTANT_A_DELIVRER2',
BENEFICIAIRES_PREVISIONNELS = '$BENEFICIAIRES_PREVISIONNELS',
ETAT_ACTUEL_LIVRABLE = '$ETAT_ACTUEL_LIVRABLE',
TAUX_EXECUTION_PHYSIQUE = '$TAUX_EXECUTION_PHYSIQUE',
TAUX_EXECUTION_FINANCIERE = '$TAUX_EXECUTION_FINANCIERE',
RESTE_A_EXECUTER = '$RESTE_A_EXECUTER',
NIVEAU_SATISFACTION_BENEFICIAIRES = '$NIVEAU_SATISFACTION_BENEFICIAIRES',
NOM_CF = '$NOM_CF',
CONTACT_CF = '$CONTACT_CF',
NOM_COORDONNATEUR = '$NOM_COORDONNATEUR',
CONTACT_COORD = '$CONTACT_COORD',
observation = '$observation'
WHERE id = '$id'";

if ($conn->query($sql) === TRUE) {
    // Modification réussie, afficher un message de succès
    echo "Le projet a été modifié avec succès.";

    // Redirection avec un délai de 5 secondes
    header("Refresh: 5; url=saisie_projet.php");
    echo "Vous serez redirigé vers la page de saisie dans 5 secondes...";
    exit();
} else {
    // Erreur lors de la modification, afficher un message d'erreur
    echo "Erreur lors de la modification du projet : " . $conn->error;
}
}

?>
